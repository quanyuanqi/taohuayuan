<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>桃花源</title>
<style>
body {
  font-family: "PingFang SC", "Microsoft YaHei", sans-serif;
  background-color: #f8f9fa;
  color: #333;
  padding: 20px;
}
.title-container {
  text-align: center;
  margin: 40px auto 24px;
}
input, textarea {
  width: 100%;
  padding: 10px;
  border: 1px solid #ccc;
  border-radius: 6px;
  font-size: 1rem;
  background-repeat: no-repeat;
  background-position: right 10px top 10px;
  background-size: auto 1rem;
}
input::placeholder {
  color: #aaa;
}
textarea::placeholder {
  color: #aaa;
}
button {
  background-color: #0056b3;
  color: white;
  border: none;
  padding: 10px 20px;
  border-radius: 6px;
  cursor: pointer;
}
button:hover { background-color: #004299; }
.advice-item {
  border-bottom: 1px solid #eee;
  padding: 10px 0;
}
</style>
</head>
<body>
  <div class="title-container">
    <h2>小区建言献策</h2>
    <p>分享你的见解，共建和谐社区</p>
  </div>

  <div>
    <form id="adviceForm">
      <div>
        <label>标题：</label>
        <input type="text" id="title" name="title" placeholder="（限100字）" maxlength="100" required>
      </div>
      <div>
        <label>内容：</label>
        <textarea id="content" name="content" rows="4" placeholder="（限2000字）" maxlength="2000" required></textarea>
      </div>
      <button type="submit">提交建议</button>
    </form>
  </div>

  <div style="margin-top:30px;">
    <h3>最近建议</h3>
    <div id="postsContainer">加载中...</div>
  </div>

<script>
const CLOUDFLARE_WORKER_URL = "/"; // same origin when using Pages+Functions

async function loadPosts() {
  const c = document.getElementById("postsContainer");
  c.textContent = "加载中...";
  try {
    const res = await fetch(CLOUDFLARE_WORKER_URL + "posts");
    const posts = await res.json();
    if (!posts.length) c.textContent = "暂无建议内容。";
    else c.innerHTML = posts.map(p => `<div class="advice-item"><h4>${p.title}</h4><p>${p.content}</p></div>`).join("");
  } catch {
    c.textContent = "加载失败。";
  }
}

document.getElementById("adviceForm").addEventListener("submit", async (e) => {
  e.preventDefault();
  const title = titleInput.value.trim();
  const content = contentInput.value.trim();
  if (!title || !content) return alert("请填写完整内容！");
  const res = await fetch("posts", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ title, content })
  });
  if (res.ok) {
    alert("提交成功！");
    e.target.reset();
    loadPosts();
  } else {
    const err = await res.json();
    alert("提交失败：" + (err.error || "未知错误"));
  }
});

const titleInput = document.getElementById("title");
const contentInput = document.getElementById("content");
window.onload = loadPosts;
</script>
</body>
</html>
